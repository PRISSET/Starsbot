# üîí –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Telegram –±–æ—Ç–∞

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤–∞—à–µ–≥–æ Telegram –±–æ—Ç–∞ —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏ –∑–≤–µ–∑–¥–∞–º–∏.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û—Å–Ω–æ–≤—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](#–æ—Å–Ω–æ–≤—ã-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
- [–ó–∞—â–∏—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤ –∏ –∫–ª—é—á–µ–π](#–∑–∞—â–∏—Ç–∞-—Ç–æ–∫–µ–Ω–æ–≤-–∏-–∫–ª—é—á–µ–π)
- [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
- [–ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫](#–∑–∞—â–∏—Ç–∞-–æ—Ç-–∞—Ç–∞–∫)
- [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
- [–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ä–µ–∑–µ—Ä–≤–Ω–æ–µ-–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [–ê—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](#–∞—É–¥–∏—Ç-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
- [–ò–Ω—Ü–∏–¥–µ–Ω—Ç-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç](#–∏–Ω—Ü–∏–¥–µ–Ω—Ç-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç)

## üõ°Ô∏è –û—Å–Ω–æ–≤—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ü—Ä–∏–Ω—Ü–∏–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏** - –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∞
2. **–ì–ª—É–±–æ–∫–∞—è –∑–∞—â–∏—Ç–∞** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π –∑–∞—â–∏—Ç—ã
3. **–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –≤ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
5. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Ä–µ–≥—É–ª—è—Ä–Ω–æ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –±—ç–∫–∞–ø—ã

### –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```python
# config.py - –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
SECURITY_SETTINGS = {
    'MAX_REQUESTS_PER_MINUTE': 60,
    'MAX_PAYMENT_ATTEMPTS': 3,
    'SESSION_TIMEOUT': 3600,  # 1 —á–∞—Å
    'ADMIN_SESSION_TIMEOUT': 1800,  # 30 –º–∏–Ω—É—Ç
    'ENABLE_RATE_LIMITING': True,
    'LOG_SENSITIVE_DATA': False,
    'REQUIRE_ADMIN_2FA': True
}
```

## üîë –ó–∞—â–∏—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤ –∏ –∫–ª—é—á–µ–π

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏

#### 1. –§–∞–π–ª .env

**‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ:**
```env
# .env - –ù–ï –¥–æ–±–∞–≤–ª—è–π—Ç–µ –≤ git!
BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
ADMIN_IDS=123456789,987654321
DATABASE_ENCRYPTION_KEY=your-32-char-encryption-key-here
```

**‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
```python
# bot.py - –ù–ò–ö–û–ì–î–ê –Ω–µ –¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫!
BOT_TOKEN = "1234567890:ABCdefGHIjklMNOpqrsTUVwxyz"  # –•–∞—Ä–¥–∫–æ–¥ —Ç–æ–∫–µ–Ω–∞
```

#### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ .gitignore

```gitignore
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤—å—Ç–µ –≤ .gitignore
.env
*.log
bot.db
backups/
__pycache__/
*.pyc
.venv/
venv/
```

#### 3. –†–æ—Ç–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤

```bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–æ—Ç–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
#!/bin/bash

echo "üîÑ –†–æ—Ç–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –±–æ—Ç–∞"
echo "1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω –≤ @BotFather"
echo "2. –û–±–Ω–æ–≤–∏—Ç–µ BOT_TOKEN –≤ .env"
echo "3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞"
echo "4. –û—Ç–∑–æ–≤–∏—Ç–µ —Å—Ç–∞—Ä—ã–π —Ç–æ–∫–µ–Ω –≤ @BotFather"
```

### –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

```python
# utils.py - –§—É–Ω–∫—Ü–∏–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
import os
from cryptography.fernet import Fernet

class DataEncryption:
    def __init__(self):
        key = os.getenv('DATABASE_ENCRYPTION_KEY')
        if not key:
            key = Fernet.generate_key()
            print(f"Generated new encryption key: {key.decode()}")
        self.cipher = Fernet(key.encode() if isinstance(key, str) else key)
    
    def encrypt(self, data: str) -> str:
        """–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏"""
        return self.cipher.encrypt(data.encode()).decode()
    
    def decrypt(self, encrypted_data: str) -> str:
        """–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ —Å—Ç—Ä–æ–∫–∏"""
        return self.cipher.decrypt(encrypted_data.encode()).decode()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
encryption = DataEncryption()
sensitive_data = encryption.encrypt("sensitive information")
```

## üóÑÔ∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ó–∞—â–∏—Ç–∞ SQLite

```python
# database.py - –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
class SecureDatabase:
    async def safe_query(self, query: str, params: tuple = ()):
        """–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏"""
        async with aiosqlite.connect(self.db_path) as db:
            # –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
            cursor = await db.execute(query, params)
            return await cursor.fetchall()
    
    async def get_user_safe(self, user_id: int):
        """–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
        query = "SELECT * FROM users WHERE telegram_id = ?"
        return await self.safe_query(query, (user_id,))
    
    async def get_user_unsafe(self, user_id: int):
        """‚ùå –ù–ï–ë–ï–ó–û–ü–ê–°–ù–û - —É—è–∑–≤–∏–º–æ –∫ SQL-–∏–Ω—ä–µ–∫—Ü–∏—è–º"""
        query = f"SELECT * FROM users WHERE telegram_id = {user_id}"
        # –ù–ï –ò–°–ü–û–õ–¨–ó–£–ô–¢–ï —Ç–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã!
```

### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
chmod 600 .env          # –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å
chmod 600 bot.db        # –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å
chmod 700 backups/      # –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç –≤—Ö–æ–¥–∏—Ç—å –≤ –ø–∞–ø–∫—É
chmod 644 *.py          # –í—Å–µ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å, –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å
```

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º

```bash
#!/bin/bash
# secure_backup.sh

BACKUP_DIR="/secure/backups"
DATE=$(date +%Y%m%d_%H%M%S)
PASSWORD="your-backup-password"

# –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∞—Ä—Ö–∏–≤–∞
tar -czf - bot.db .env | gpg --symmetric --cipher-algo AES256 --compress-algo 1 --s2k-mode 3 --s2k-digest-algo SHA512 --s2k-count 65536 --force-mdc --passphrase "$PASSWORD" > "$BACKUP_DIR/backup_$DATE.tar.gz.gpg"

echo "Encrypted backup created: backup_$DATE.tar.gz.gpg"
```

## üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫

### Rate Limiting (–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤)

```python
# rate_limiter.py
import time
from collections import defaultdict, deque
from typing import Dict, Deque

class RateLimiter:
    def __init__(self, max_requests: int = 60, window_seconds: int = 60):
        self.max_requests = max_requests
        self.window_seconds = window_seconds
        self.requests: Dict[int, Deque[float]] = defaultdict(deque)
    
    def is_allowed(self, user_id: int) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞, —Ä–∞–∑—Ä–µ—à–µ–Ω –ª–∏ –∑–∞–ø—Ä–æ—Å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        now = time.time()
        user_requests = self.requests[user_id]
        
        # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã
        while user_requests and user_requests[0] < now - self.window_seconds:
            user_requests.popleft()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç
        if len(user_requests) >= self.max_requests:
            return False
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –∑–∞–ø—Ä–æ—Å
        user_requests.append(now)
        return True
    
    def get_remaining_requests(self, user_id: int) -> int:
        """–ü–æ–ª—É—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∑–∞–ø—Ä–æ—Å–æ–≤"""
        return max(0, self.max_requests - len(self.requests[user_id]))

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –±–æ—Ç–µ
rate_limiter = RateLimiter(max_requests=30, window_seconds=60)

@dp.message()
async def handle_message(message: types.Message):
    if not rate_limiter.is_allowed(message.from_user.id):
        await message.answer("‚ö†Ô∏è –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")
        return
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
    await process_message(message)
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```python
# validators.py
import re
from typing import Optional

class InputValidator:
    @staticmethod
    def validate_telegram_id(user_id: int) -> bool:
        """–í–∞–ª–∏–¥–∞—Ü–∏—è Telegram ID"""
        return isinstance(user_id, int) and 1 <= user_id <= 2**63 - 1
    
    @staticmethod
    def validate_username(username: str) -> bool:
        """–í–∞–ª–∏–¥–∞—Ü–∏—è username"""
        if not username:
            return True  # Username –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º
        pattern = r'^[a-zA-Z0-9_]{5,32}$'
        return bool(re.match(pattern, username))
    
    @staticmethod
    def validate_amount(amount: int) -> bool:
        """–í–∞–ª–∏–¥–∞—Ü–∏—è —Å—É–º–º—ã –ø–ª–∞—Ç–µ–∂–∞"""
        return isinstance(amount, int) and 1 <= amount <= 2500  # –õ–∏–º–∏—Ç—ã Telegram Stars
    
    @staticmethod
    def sanitize_text(text: str, max_length: int = 1000) -> str:
        """–û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –æ—Ç –æ–ø–∞—Å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤"""
        if not text:
            return ""
        
        # –£–¥–∞–ª—è–µ–º –æ–ø–∞—Å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
        text = re.sub(r'[<>"\'\/]', '', text)
        
        # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É
        return text[:max_length]
    
    @staticmethod
    def validate_product_id(product_id: str) -> bool:
        """–í–∞–ª–∏–¥–∞—Ü–∏—è ID —Ç–æ–≤–∞—Ä–∞"""
        pattern = r'^[a-zA-Z0-9_]{1,50}$'
        return bool(re.match(pattern, product_id))

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
validator = InputValidator()

async def process_payment(user_id: int, product_id: str, amount: int):
    if not validator.validate_telegram_id(user_id):
        raise ValueError("Invalid user ID")
    
    if not validator.validate_product_id(product_id):
        raise ValueError("Invalid product ID")
    
    if not validator.validate_amount(amount):
        raise ValueError("Invalid amount")
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞
```

### –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞

```python
# anti_spam.py
from datetime import datetime, timedelta
from typing import Dict, Set

class AntiSpam:
    def __init__(self):
        self.user_messages: Dict[int, list] = {}
        self.blocked_users: Set[int] = set()
        self.spam_threshold = 10  # —Å–æ–æ–±—â–µ–Ω–∏–π
        self.time_window = 60  # —Å–µ–∫—É–Ω–¥
        self.block_duration = 300  # 5 –º–∏–Ω—É—Ç
    
    def is_spam(self, user_id: int) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–ø–∞–º"""
        now = datetime.now()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        if user_id in self.blocked_users:
            return True
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        if user_id not in self.user_messages:
            self.user_messages[user_id] = []
        
        # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        cutoff_time = now - timedelta(seconds=self.time_window)
        self.user_messages[user_id] = [
            msg_time for msg_time in self.user_messages[user_id]
            if msg_time > cutoff_time
        ]
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        self.user_messages[user_id].append(now)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞
        if len(self.user_messages[user_id]) > self.spam_threshold:
            self.blocked_users.add(user_id)
            # –ü–ª–∞–Ω–∏—Ä—É–µ–º —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫—É
            # –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
            return True
        
        return False
    
    def unblock_user(self, user_id: int):
        """–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        self.blocked_users.discard(user_id)
        if user_id in self.user_messages:
            del self.user_messages[user_id]

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
anti_spam = AntiSpam()

@dp.message()
async def handle_message(message: types.Message):
    if anti_spam.is_spam(message.from_user.id):
        await message.answer("üö´ –í—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –∑–∞ —Å–ø–∞–º. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")
        return
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```python
# security_logger.py
import logging
from datetime import datetime
from typing import Optional

class SecurityLogger:
    def __init__(self):
        self.logger = logging.getLogger('security')
        handler = logging.FileHandler('security.log')
        formatter = logging.Formatter(
            '%(asctime)s - %(levelname)s - %(message)s'
        )
        handler.setFormatter(formatter)
        self.logger.addHandler(handler)
        self.logger.setLevel(logging.INFO)
    
    def log_login_attempt(self, user_id: int, success: bool, ip: Optional[str] = None):
        """–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞"""
        status = "SUCCESS" if success else "FAILED"
        self.logger.info(f"LOGIN_{status}: User {user_id} from {ip or 'unknown'}")
    
    def log_payment_attempt(self, user_id: int, amount: int, success: bool):
        """–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –ø–ª–∞—Ç–µ–∂–∞"""
        status = "SUCCESS" if success else "FAILED"
        self.logger.info(f"PAYMENT_{status}: User {user_id}, Amount {amount}")
    
    def log_admin_action(self, admin_id: int, action: str, target: Optional[str] = None):
        """–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
        self.logger.warning(f"ADMIN_ACTION: Admin {admin_id} performed {action} on {target or 'system'}")
    
    def log_security_incident(self, incident_type: str, user_id: int, details: str):
        """–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"""
        self.logger.error(f"SECURITY_INCIDENT: {incident_type} - User {user_id} - {details}")
    
    def log_suspicious_activity(self, user_id: int, activity: str):
        """–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"""
        self.logger.warning(f"SUSPICIOUS_ACTIVITY: User {user_id} - {activity}")

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
security_logger = SecurityLogger()

async def process_payment(user_id: int, amount: int):
    try:
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞
        result = await handle_payment(user_id, amount)
        security_logger.log_payment_attempt(user_id, amount, True)
        return result
    except Exception as e:
        security_logger.log_payment_attempt(user_id, amount, False)
        security_logger.log_security_incident(
            "PAYMENT_ERROR", user_id, str(e)
        )
        raise
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤

```python
# system_monitor.py
import psutil
import asyncio
from datetime import datetime

class SystemMonitor:
    def __init__(self):
        self.alerts_sent = set()
    
    async def check_system_health(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã"""
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CPU
        cpu_percent = psutil.cpu_percent(interval=1)
        if cpu_percent > 80:
            await self.send_alert(f"High CPU usage: {cpu_percent}%")
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
        memory = psutil.virtual_memory()
        if memory.percent > 85:
            await self.send_alert(f"High memory usage: {memory.percent}%")
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
        disk = psutil.disk_usage('/')
        if disk.percent > 90:
            await self.send_alert(f"Low disk space: {disk.percent}% used")
    
    async def send_alert(self, message: str):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º"""
        alert_key = f"{message}_{datetime.now().hour}"
        if alert_key not in self.alerts_sent:
            # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
            for admin_id in ADMIN_IDS:
                try:
                    await bot.send_message(admin_id, f"üö® System Alert: {message}")
                except:
                    pass
            self.alerts_sent.add(alert_key)
    
    async def start_monitoring(self):
        """–ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞"""
        while True:
            try:
                await self.check_system_health()
                await asyncio.sleep(300)  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
            except Exception as e:
                print(f"Monitoring error: {e}")
                await asyncio.sleep(60)

# –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
monitor = SystemMonitor()
asyncio.create_task(monitor.start_monitoring())
```

## üíæ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±—ç–∫–∞–ø—ã

```python
# backup_manager.py
import os
import shutil
import asyncio
from datetime import datetime, timedelta
from cryptography.fernet import Fernet

class SecureBackupManager:
    def __init__(self, backup_dir: str = "backups"):
        self.backup_dir = backup_dir
        self.encryption_key = os.getenv('BACKUP_ENCRYPTION_KEY')
        if not self.encryption_key:
            self.encryption_key = Fernet.generate_key()
            print(f"Generated backup encryption key: {self.encryption_key.decode()}")
        
        self.cipher = Fernet(self.encryption_key)
        os.makedirs(backup_dir, exist_ok=True)
    
    async def create_backup(self):
        """–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞"""
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        backup_name = f"backup_{timestamp}"
        
        try:
            # –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø–∞–ø–∫–∏
            temp_dir = f"temp_{backup_name}"
            os.makedirs(temp_dir, exist_ok=True)
            
            # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
            shutil.copy2("bot.db", f"{temp_dir}/bot.db")
            shutil.copy2(".env", f"{temp_dir}/.env")
            
            # –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞
            archive_path = f"{self.backup_dir}/{backup_name}.tar.gz"
            shutil.make_archive(archive_path[:-7], 'gztar', temp_dir)
            
            # –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞
            with open(archive_path, 'rb') as f:
                encrypted_data = self.cipher.encrypt(f.read())
            
            encrypted_path = f"{archive_path}.enc"
            with open(encrypted_path, 'wb') as f:
                f.write(encrypted_data)
            
            # –£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
            os.remove(archive_path)
            shutil.rmtree(temp_dir)
            
            print(f"‚úÖ Backup created: {encrypted_path}")
            return encrypted_path
            
        except Exception as e:
            print(f"‚ùå Backup failed: {e}")
            return None
    
    async def restore_backup(self, backup_path: str):
        """–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞"""
        try:
            # –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞
            with open(backup_path, 'rb') as f:
                decrypted_data = self.cipher.decrypt(f.read())
            
            # –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∞—Ä—Ö–∏–≤–∞
            temp_archive = "temp_restore.tar.gz"
            with open(temp_archive, 'wb') as f:
                f.write(decrypted_data)
            
            # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞
            shutil.unpack_archive(temp_archive, "restored")
            
            # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
            if os.path.exists("restored/bot.db"):
                shutil.copy2("restored/bot.db", "bot.db")
            if os.path.exists("restored/.env"):
                shutil.copy2("restored/.env", ".env")
            
            # –û—á–∏—Å—Ç–∫–∞
            os.remove(temp_archive)
            shutil.rmtree("restored")
            
            print("‚úÖ Backup restored successfully")
            return True
            
        except Exception as e:
            print(f"‚ùå Restore failed: {e}")
            return False
    
    async def cleanup_old_backups(self, days_to_keep: int = 30):
        """–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤"""
        cutoff_date = datetime.now() - timedelta(days=days_to_keep)
        
        for filename in os.listdir(self.backup_dir):
            if filename.startswith("backup_") and filename.endswith(".tar.gz.enc"):
                file_path = os.path.join(self.backup_dir, filename)
                file_time = datetime.fromtimestamp(os.path.getctime(file_path))
                
                if file_time < cutoff_date:
                    os.remove(file_path)
                    print(f"üóëÔ∏è Removed old backup: {filename}")
    
    async def start_scheduled_backups(self, interval_hours: int = 24):
        """–ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤"""
        while True:
            await self.create_backup()
            await self.cleanup_old_backups()
            await asyncio.sleep(interval_hours * 3600)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
backup_manager = SecureBackupManager()
asyncio.create_task(backup_manager.start_scheduled_backups(interval_hours=12))
```

## üîç –ê—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ß–µ–∫-–ª–∏—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```python
# security_audit.py
import os
import stat
import sqlite3
from pathlib import Path

class SecurityAudit:
    def __init__(self):
        self.issues = []
        self.warnings = []
        self.passed = []
    
    def check_file_permissions(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º"""
        sensitive_files = ['.env', 'bot.db']
        
        for filename in sensitive_files:
            if os.path.exists(filename):
                file_stat = os.stat(filename)
                permissions = stat.filemode(file_stat.st_mode)
                
                if permissions != '-rw-------':
                    self.issues.append(f"File {filename} has insecure permissions: {permissions}")
                else:
                    self.passed.append(f"File {filename} has secure permissions")
            else:
                self.warnings.append(f"File {filename} not found")
    
    def check_environment_variables(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è"""
        required_vars = ['BOT_TOKEN', 'ADMIN_IDS']
        
        for var in required_vars:
            if not os.getenv(var):
                self.issues.append(f"Missing required environment variable: {var}")
            else:
                self.passed.append(f"Environment variable {var} is set")
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–∞
        bot_token = os.getenv('BOT_TOKEN', '')
        if len(bot_token) < 40:
            self.issues.append("BOT_TOKEN appears to be invalid or too short")
    
    def check_database_security(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
        if not os.path.exists('bot.db'):
            self.warnings.append("Database file not found")
            return
        
        try:
            conn = sqlite3.connect('bot.db')
            cursor = conn.cursor()
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
            cursor.execute("SELECT name FROM sqlite_master WHERE type='index'")
            indexes = cursor.fetchall()
            
            if len(indexes) < 3:
                self.warnings.append("Database may lack proper indexing")
            else:
                self.passed.append("Database has proper indexing")
            
            conn.close()
            
        except Exception as e:
            self.issues.append(f"Database check failed: {e}")
    
    def check_code_security(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞"""
        python_files = list(Path('.').glob('*.py'))
        
        for file_path in python_files:
            with open(file_path, 'r', encoding='utf-8') as f:
                content = f.read()
                
                # –ü–æ–∏—Å–∫ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
                if 'eval(' in content:
                    self.issues.append(f"Dangerous eval() found in {file_path}")
                
                if 'exec(' in content:
                    self.issues.append(f"Dangerous exec() found in {file_path}")
                
                if 'shell=True' in content:
                    self.warnings.append(f"shell=True found in {file_path} - review for security")
                
                if 'password' in content.lower() and '=' in content:
                    self.warnings.append(f"Possible hardcoded password in {file_path}")
    
    def check_dependencies(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"""
        if os.path.exists('requirements.txt'):
            with open('requirements.txt', 'r') as f:
                deps = f.read()
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –≤–µ—Ä—Å–∏–∏
                if 'aiogram==' not in deps:
                    self.warnings.append("Aiogram version not pinned in requirements.txt")
                
                self.passed.append("Requirements.txt exists")
        else:
            self.issues.append("requirements.txt not found")
    
    def run_audit(self):
        """–ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ –∞—É–¥–∏—Ç–∞"""
        print("üîç Starting security audit...\n")
        
        self.check_file_permissions()
        self.check_environment_variables()
        self.check_database_security()
        self.check_code_security()
        self.check_dependencies()
        
        # –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        if self.issues:
            print("‚ùå CRITICAL ISSUES:")
            for issue in self.issues:
                print(f"   ‚Ä¢ {issue}")
            print()
        
        if self.warnings:
            print("‚ö†Ô∏è  WARNINGS:")
            for warning in self.warnings:
                print(f"   ‚Ä¢ {warning}")
            print()
        
        if self.passed:
            print("‚úÖ PASSED CHECKS:")
            for check in self.passed:
                print(f"   ‚Ä¢ {check}")
            print()
        
        # –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞
        total_checks = len(self.issues) + len(self.warnings) + len(self.passed)
        score = (len(self.passed) / total_checks) * 100 if total_checks > 0 else 0
        
        print(f"üìä Security Score: {score:.1f}%")
        
        if self.issues:
            print("\nüö® Please fix critical issues before deploying!")
        elif self.warnings:
            print("\n‚ö†Ô∏è  Consider addressing warnings for better security.")
        else:
            print("\nüéâ All security checks passed!")

if __name__ == "__main__":
    audit = SecurityAudit()
    audit.run_audit()
```

## üö® –ò–Ω—Ü–∏–¥–µ–Ω—Ç-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç

### –ü–ª–∞–Ω —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

```python
# incident_response.py
import asyncio
from datetime import datetime
from enum import Enum

class IncidentSeverity(Enum):
    LOW = "low"
    MEDIUM = "medium"
    HIGH = "high"
    CRITICAL = "critical"

class IncidentManager:
    def __init__(self):
        self.active_incidents = {}
        self.incident_counter = 0
    
    async def report_incident(self, incident_type: str, severity: IncidentSeverity, 
                            description: str, affected_users: list = None):
        """–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞"""
        self.incident_counter += 1
        incident_id = f"INC-{self.incident_counter:04d}"
        
        incident = {
            'id': incident_id,
            'type': incident_type,
            'severity': severity,
            'description': description,
            'affected_users': affected_users or [],
            'created_at': datetime.now(),
            'status': 'open',
            'actions_taken': []
        }
        
        self.active_incidents[incident_id] = incident
        
        # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏
        await self._handle_incident_severity(incident)
        
        return incident_id
    
    async def _handle_incident_severity(self, incident):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏"""
        if incident['severity'] == IncidentSeverity.CRITICAL:
            # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç - –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
            await self._notify_all_admins(incident)
            await self._enable_maintenance_mode()
            
        elif incident['severity'] == IncidentSeverity.HIGH:
            # –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
            await self._notify_all_admins(incident)
            
        elif incident['severity'] == IncidentSeverity.MEDIUM:
            # –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            await self._log_incident(incident)
            await self._notify_primary_admin(incident)
    
    async def _notify_all_admins(self, incident):
        """–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤"""
        message = f"üö® INCIDENT {incident['id']}\n"
        message += f"Severity: {incident['severity'].value.upper()}\n"
        message += f"Type: {incident['type']}\n"
        message += f"Description: {incident['description']}\n"
        message += f"Time: {incident['created_at']}\n"
        
        for admin_id in ADMIN_IDS:
            try:
                await bot.send_message(admin_id, message)
            except:
                pass
    
    async def _enable_maintenance_mode(self):
        """–í–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è"""
        # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –±–æ—Ç–∞
        # –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
        pass
    
    async def close_incident(self, incident_id: str, resolution: str):
        """–ó–∞–∫—Ä—ã—Ç–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞"""
        if incident_id in self.active_incidents:
            self.active_incidents[incident_id]['status'] = 'closed'
            self.active_incidents[incident_id]['resolution'] = resolution
            self.active_incidents[incident_id]['closed_at'] = datetime.now()
            
            # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–∫—Ä—ã—Ç–∏–∏
            message = f"‚úÖ INCIDENT {incident_id} RESOLVED\n"
            message += f"Resolution: {resolution}"
            
            for admin_id in ADMIN_IDS:
                try:
                    await bot.send_message(admin_id, message)
                except:
                    pass

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
incident_manager = IncidentManager()

# –ü—Ä–∏–º–µ—Ä —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞
async def handle_payment_failure(user_id: int, error: str):
    await incident_manager.report_incident(
        incident_type="payment_failure",
        severity=IncidentSeverity.HIGH,
        description=f"Payment failed for user {user_id}: {error}",
        affected_users=[user_id]
    )
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [OWASP Top 10](https://owasp.org/www-project-top-ten/) - –¢–æ–ø —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- [Telegram Bot Security](https://core.telegram.org/bots/faq#security) - –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –±–æ—Ç–æ–≤
- [Python Security](https://python-security.readthedocs.io/) - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Python
- [SQLite Security](https://www.sqlite.org/security.html) - –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å SQLite

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∞—É–¥–∏—Ç–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
pip install bandit safety

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –Ω–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–∏
bandit -r .

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
safety check

# –ü—Ä–æ–≤–µ—Ä–∫–∞ requirements.txt
safety check -r requirements.txt
```

### –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –∑–∞–¥–∞—á–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–ï–∂–µ–¥–Ω–µ–≤–Ω–æ:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π

**–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ:**
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
- –ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞—Ñ–∏–∫–∞ –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**–ï–∂–µ–º–µ—Å—è—á–Ω–æ:**
- –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π –∏ —Ç–æ–∫–µ–Ω–æ–≤
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ –±—ç–∫–∞–ø–æ–≤
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

**–ï–∂–µ–∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ:**
- –ü–µ–Ω—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –û–±–∑–æ—Ä –ø–æ–ª–∏—Ç–∏–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –û–±—É—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã

–°–ª–µ–¥—É—è —ç—Ç–∏–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º, –≤—ã –æ–±–µ—Å–ø–µ—á–∏—Ç–µ –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤–∞—à–µ–≥–æ Telegram –±–æ—Ç–∞ —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏ –∑–≤–µ–∑–¥–∞–º–∏. –ü–æ–º–Ω–∏—Ç–µ: –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - —ç—Ç–æ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å, —Ç—Ä–µ–±—É—é—â–∏–π –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.